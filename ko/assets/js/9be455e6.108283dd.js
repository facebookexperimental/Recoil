"use strict";(self.webpackChunkrecoil=self.webpackChunkrecoil||[]).push([[5680],{3905:function(e,r,n){n.d(r,{Zo:function(){return u},kt:function(){return m}});var t=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=t.createContext({}),p=function(e){var r=t.useContext(s),n=r;return e&&(n="function"==typeof e?e(r):l(l({},r),e)),n},u=function(e){var r=p(e.components);return t.createElement(s.Provider,{value:r},e.children)},c={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?t.createElement(h,l(l({ref:r},u),{},{components:n})):t.createElement(h,l({ref:r},u))}));function m(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in r)hasOwnProperty.call(r,s)&&(i[s]=r[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1397:function(e,r,n){n.r(r),n.d(r,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var t=n(7462),a=n(3366),o=(n(7294),n(3905)),l=["components"],i={title:"GraphQL Queries",sidebar_label:"GraphQL Queries"},s=void 0,p={unversionedId:"recoil-relay/graphql-queries",id:"recoil-relay/graphql-queries",title:"GraphQL Queries",description:"GraphQL queries can be done using graphQLSelector() and graphQLSelectorFamily().  (The underlying support is provided via atom effects).  But first, make sure to setup your Relay environment.",source:"@site/docs/recoil-relay/graphql-queries.md",sourceDirName:"recoil-relay",slug:"/recoil-relay/graphql-queries",permalink:"/ko/docs/recoil-relay/graphql-queries",editUrl:"https://github.com/facebookexperimental/Recoil/edit/docs/docs/i18n/ko/docusaurus-plugin-content-docs/current/recoil-relay/graphql-queries.md",tags:[],version:"current",frontMatter:{title:"GraphQL Queries",sidebar_label:"GraphQL Queries"},sidebar:"recoil-relay",previous:{title:"Relay Environment",permalink:"/ko/docs/recoil-relay/environment"},next:{title:"GraphQL Mutations",permalink:"/ko/docs/recoil-relay/graphql-mutations"}},u=[{value:"Simple GraphQL Query",id:"simple-graphql-query",children:[],level:2},{value:"GraphQL Query with Parameters",id:"graphql-query-with-parameters",children:[],level:2},{value:"GraphQL Fragments",id:"graphql-fragments",children:[],level:2},{value:"Pre-fetch GraphQL",id:"pre-fetch-graphql",children:[],level:2},{value:"Preloaded GraphQL",id:"preloaded-graphql",children:[],level:2}],c={toc:u};function d(e){var r=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,t.Z)({},c,n,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"GraphQL queries can be done using ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/api/graphQLSelector"},(0,o.kt)("strong",{parentName:"a"},(0,o.kt)("inlineCode",{parentName:"strong"},"graphQLSelector()")))," and ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/api/graphQLSelectorFamily"},(0,o.kt)("strong",{parentName:"a"},(0,o.kt)("inlineCode",{parentName:"strong"},"graphQLSelectorFamily()"))),".  (The underlying support is provided via ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/graphql-effects"},"atom effects"),").  But first, make sure to ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/environment"},"setup your Relay environment"),"."),(0,o.kt)("h2",{id:"simple-graphql-query"},"Simple GraphQL Query"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/api/graphQLSelector"},(0,o.kt)("strong",{parentName:"a"},(0,o.kt)("inlineCode",{parentName:"strong"},"graphQLSelector()")))," can be used to create a selector which is synced with a ",(0,o.kt)("a",{parentName:"p",href:"https://graphql.org/learn/queries/"},(0,o.kt)("strong",{parentName:"a"},"GraphQL query")),".  This selector helps GraphQL queries and the Recoil data-flow graph stay in sync.  It can depend on upstream Recoil atoms/selectors to determine the ",(0,o.kt)("a",{parentName:"p",href:"https://graphql.org/learn/queries/#variables"},(0,o.kt)("inlineCode",{parentName:"a"},"variables"))," to use for the GraphQL query or transform the results.  Any ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/graphql-mutations"},"mutations"),", ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/graphql-mutations#local-updates"},"local updates"),", ",(0,o.kt)("a",{parentName:"p",href:"https://graphql.org/blog/2020-12-08-improving-latency-with-defer-and-stream-directives/"},"deferred data"),", or ",(0,o.kt)("a",{parentName:"p",href:"https://the-guild.dev/blog/subscriptions-and-live-queries-real-time-with-graphql"},"live queries")," to the Relay GraphQL state will also automatically sync with the selector and cause it to update.  This allows you to treat the server as the source of truth with the selector as a local cache."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const userNameQuery = graphQLSelector({\n  key: 'UserName',\n  environment: myEnvironmentKey,\n  query: graphql`\n    query UserNameQuery($id: ID!) {\n      user(id: $id) {\n        name\n      }\n    }\n  `,\n  variables: ({get}) => ({id: get(currentIDAtom)}),\n  mapResponse: data => data.user?.name,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function MyComponent() {\n  const seenCount = useRecoilValue(seenCountQuery);\n  return <span>{seenCount}</span>;\n}\n")),(0,o.kt)("p",null,"In addition to using other upstream atoms/selectors to compute the GraphQL query variables, the ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/api/graphQLSelector"},(0,o.kt)("inlineCode",{parentName:"a"},"graphQLSelector()"))," can also be used by other downstream selectors to provide derived state."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const pictureForUserState = selector({\n  key: 'PictureForUser',\n  get: async ({get}) => {\n    const username = get(userNameQuery);\n    const picture = await fetch(urlForUserNamePicture(username));\n    return picture;\n  },\n});\n")),(0,o.kt)("h2",{id:"graphql-query-with-parameters"},"GraphQL Query with Parameters"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/api/graphQLSelectorFamily"},(0,o.kt)("strong",{parentName:"a"},(0,o.kt)("inlineCode",{parentName:"strong"},"graphQLSelectorFamily()")))," allows you to use parameters in addition to other Recoil state for computing query variables.  Parameters can be determined basd on a component's props, React state, used in another Recoil selector, etc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const userQuery = graphQLSelectorFamily({\n  key: 'UserQuery',\n  environment: myEnvironmentKey,\n  query: graphql`\n    query UserQuery($id: ID!, $clientID: ClientID!) {\n      user(id: $id, client_id: $clientID) {\n        name\n        address\n      }\n    }\n  `,\n  variables: id => ({get}) => ({id, clientID: get(clientIDAtom}),\n  mapResponse: data => data.user,\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function MyComponent(props) {\n  const user = useRecoilValue(userQuery(props.userID));\n\n  return (\n    <div>\n      <h1>{user.name}</h1>\n    </div>\n  );\n}\n")),(0,o.kt)("h2",{id:"graphql-fragments"},"GraphQL Fragments"),(0,o.kt)("p",null,"GraphQL queries can also include ",(0,o.kt)("a",{parentName:"p",href:"https://graphql.org/learn/queries/#fragments"},(0,o.kt)("strong",{parentName:"a"},"GraphQL fragments"))," through the use of the ",(0,o.kt)("a",{parentName:"p",href:"https://relay.dev/docs/api-reference/graphql-and-directives/#inline"},(0,o.kt)("inlineCode",{parentName:"a"},"@inline"))," directive and ",(0,o.kt)("inlineCode",{parentName:"p"},"readInlineData()"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const userNameFragment = graphql`\n  fragment UserNameFragment on User @inline {\n    name\n  }\n`;\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"import {readInlineData} from 'relay-runtime';\n\nconst userNameQuery = graphQLSelectorFamily({\n  key: 'UserNameQuery',\n  environment: myEnvironmentKey,\n  query: graphql`\n    query UserNameQuery($id: ID!) {\n      user(id: $id) {\n        ...UserNameFragment\n      }\n    }\n  `,\n  variables: id => ({id}),\n  mapResponse: response => {\n    const userFragment = readInlineData(userNameFragment, response.user);\n    return userFragment?.name;\n  },\n})\n")),(0,o.kt)("h2",{id:"pre-fetch-graphql"},"Pre-fetch GraphQL"),(0,o.kt)("p",null,"GraphQL queries can also be pre-fetched using the ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/asynchronous-data-queries#pre-fetching"},"pre-fetching pattern"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function CurrentUserInfo() {\n  const currentUserID = useRecoilValue(currentUserIDState);\n  const userInfo = useRecoilValue(userInfoQuery(currentUserID));\n\n  const changeUser = useRecoilCallback(({snapshot, set}) => userID => {\n    // pre-fetch user info\n    snapshot.getLoadable(userInfoQuery(userID));\n\n    // change current user to start new render\n    set(currentUserIDState, userID);\n  });\n\n  return (\n    <div>\n      <h1>{userInfo.name}</h1>\n      <ul>\n        {userInfo.friends.map(friend =>\n          <li key={friend.id} onClick={() => changeUser(friend.id)}>\n            {friend.name}\n          </li>\n        )}\n      </ul>\n    </div>\n  );\n}\n")),(0,o.kt)("h2",{id:"preloaded-graphql"},"Preloaded GraphQL"),(0,o.kt)("p",null,"If you are using ",(0,o.kt)("a",{parentName:"p",href:"https://relay.dev/docs/api-reference/use-entrypoint-loader/"},"EntryPoints"),", then you can preload queries in parallel with loading most of the JS for your page."),(0,o.kt)("p",null,"First, make sure you ",(0,o.kt)("a",{parentName:"p",href:"/docs/recoil-relay/environment"},"register an ",(0,o.kt)("inlineCode",{parentName:"a"},"EnvironmentKey"))," for your preloaded queries at your applications root:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"export const preloadedEnvironmentKey = new EnvironmentKey('preloaded');\n\nexport function AppRoot() {\n  const preloadedEnvironment = useRelayEnvironment();\n  return (\n    <RecoilRoot>\n      <RecoilRelayEnvironment\n        environmentKey={preloadedEnvironmentKey}\n        environment={preloadedEnvironment}>\n        {/* My App */}\n      </RecoilRelayEnvironment>\n    </RecoilRoot>\n  )\n}\n")),(0,o.kt)("p",null,"Then, direct your queries to use this ",(0,o.kt)("inlineCode",{parentName:"p"},"preloadedEnvironmentKey")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"@preloadable")," decorator to the GraphQL:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"export const userQuery = graphQLSelector({\n  key: 'UserQuery',\n  environmentKey: preloadedEnvironmentKey,\n  query: graphql`\n    query UserQuery($id: ID!) @preloadable {\n      user(id: $id) {\n        name\n      }\n    }\n  `,\n  variables: ({get}) => ({id: get(currentIDAtom)}),\n  mapResponse: data => data?.user,\n});\n")),(0,o.kt)("p",null,"Finally, add this query to the preloaded queries in your ",(0,o.kt)("inlineCode",{parentName:"p"},"*.entrypoint.js")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const MyEntryPoint = {\n  getPreloadProps: params => ({\n    queries: {\n      userQuery: {\n        parameters: require('UserQuery$Parameters'),\n        variables: {id: params.id},\n      },\n  }),\n  root: JSResource('m#MyApp.react'),\n};\n")))}d.isMDXComponent=!0}}]);